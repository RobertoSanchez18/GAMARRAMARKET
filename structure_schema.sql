/* Crear tabla PERSONA */
CREATE TABLE persona
(
   IDPER INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 200 INCREMENT BY 1,
   DNIPER CHAR(8),
   NOMPER VARCHAR2(60),
   APEPER VARCHAR2(80),
   EMAPER VARCHAR2(80),
   CELPER CHAR(9),
   TIPPER CHAR(1),
   ESTPER CHAR(1) DEFAULT 'A',
   FECNACPER DATE,
   CONSTRAINT PER_PK PRIMARY KEY (IDPER)
);
COMMIT;

CREATE TABLE venta
(
   IDVEN INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1,
   FECVEN DATE,
   IDVEND INT,
   IDCLI INT,
   TIPPAGVEN CHAR(1), /* v | c*/
   ESTVEN CHAR(1),
   CONSTRAINT VENT_PK PRIMARY KEY (IDVEN)
);
COMMIT;


-- RELACIONAR TABLA VENTA (VENDEDOR) CON PERSONA
ALTER TABLE venta
    ADD CONSTRAINT FK_VENTA_PERSONA
    FOREIGN KEY (IDVEND)
    REFERENCES persona(IDPER);
COMMIT;

-- RELACIONAR TABLA VENTA (CLIENTE) CON PERSONA
ALTER TABLE venta
    ADD CONSTRAINT FK_VENTA_CLIENTE
    FOREIGN KEY (IDCLI)
    REFERENCES persona(IDPER);
COMMIT;

CREATE TABLE venta_detalle
(
   IDVENDET INT GENERATED BY DEFAULT ON NULL AS IDENTITY START WITH 1 INCREMENT BY 1,
   IDVEND INT,
   CODPROD CHAR(3),
   CANVENDET INT,
   CONSTRAINT VENDET_PK PRIMARY KEY (IDVENDET)
);
COMMIT;

ALTER TABLE venta_detalle
    ADD CONSTRAINT VENT_UK_IDVENT
    UNIQUE (IDVEND);

-- RELACIONAR TABLA VENTA_DETALLE (VENDEDOR) CON PERSONA
ALTER TABLE venta_detalle
    ADD CONSTRAINT FK_VENTA_DETALLE
    FOREIGN KEY (IDVEND)
    REFERENCES venta (IDVEND);
COMMIT;

-- Agrega la clave foránea en la tabla venta_detalle
ALTER TABLE venta_detalle
    ADD CONSTRAINT FK_VENTA_DETALLE_PRODUCTO
    FOREIGN KEY (CODPROD)
    REFERENCES producto (CODPROD);
COMMIT;


CREATE TABLE producto
(
    CODPROD CHAR(3),
    NOMPRO VARCHAR2(50),
    IDCAT INT,
    PREPRO NUMBER(8,2),
    STOCKPRO INT,
    ESTPRO CHAR(1),
    CONSTRAINT PROD_PK PRIMARY KEY (CODPROD)
)

ALTER TABLE producto
    ADD CONSTRAINT FK_PRODUCTO_CATEGORIA
    FOREIGN KEY (IDCAT)
    REFERENCES categoria (IDCAT);
COMMIT;

CREATE TABLE categoria
(
    IDCAT INT,
    NOMCAT VARCHAR2(60),
    CONSTRAINT CAT_PK PRIMARY KEY (IDCAT)
)






